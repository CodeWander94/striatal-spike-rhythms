%%Plot the prediction improvement of models across days%%
cd('/Users/manishm/Work/vanDerMeerLab/GLM/temp/PreTrial')
rats = {'R117','R119','R131','R132'};
models = {'dphi', 'tphi', 'bphi', 'lgphi', 'hgphi', 'allphi'};
mod_pred = {};
for idx = 1:length(models)
    mod_pred.(models{idx}) = [];
end

for idx = 1:length(rats)
    curRat = rats{idx};
    searchString = strcat('S2Pre_',curRat,'*sd.mat');
    ofiles = dir(searchString);
    for jdx = 1:length(ofiles)
        load(ofiles(jdx).name);
%        N = find(sd.cellType == 0);
        N = length(sd.cellType);
        for iC = 1:N
            for iM = 1:length(models)
                mod_pred.(models{iM}) = [mod_pred.(models{iM});str2double(curRat(2:end)),sd.cellType(iC),sd.m.(models{iM}).err(iC)];
            end
        end
    end
end
%% For dphi
c_all = mod_pred.dphi(:,3);
c_all = c_all(:);
c0 = mod_pred.dphi(:,2) == 0;
c_0 = mod_pred.dphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.dphi(:,2) == 1;
c_1 = mod_pred.dphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.dphi(:,2) == 2;
c_2 = mod_pred.dphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('dphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('dphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('dphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('dphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('dphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;

%% For tphi
c_all = mod_pred.tphi(:,3);
c_all = c_all(:);
c0 = mod_pred.tphi(:,2) == 0;
c_0 = mod_pred.tphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.tphi(:,2) == 1;
c_1 = mod_pred.tphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.tphi(:,2) == 2;
c_2 = mod_pred.tphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('tphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('tphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('tphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('tphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('tphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;

%% For bphi
c_all = mod_pred.bphi(:,3);
c_all = c_all(:);
c0 = mod_pred.bphi(:,2) == 0;
c_0 = mod_pred.bphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.bphi(:,2) == 1;
c_1 = mod_pred.bphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.bphi(:,2) == 2;
c_2 = mod_pred.bphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('bphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('bphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('bphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('bphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('bphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;


%% For lgphi
c_all = mod_pred.lgphi(:,3);
c_all = c_all(:);
c0 = mod_pred.lgphi(:,2) == 0;
c_0 = mod_pred.lgphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.lgphi(:,2) == 1;
c_1 = mod_pred.lgphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.lgphi(:,2) == 2;
c_2 = mod_pred.lgphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('lgphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('lgphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('lgphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('lgphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('lgphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;


%% For hgphi
c_all = mod_pred.hgphi(:,3);
c_all = c_all(:);
c0 = mod_pred.hgphi(:,2) == 0;
c_0 = mod_pred.hgphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.hgphi(:,2) == 1;
c_1 = mod_pred.hgphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.hgphi(:,2) == 2;
c_2 = mod_pred.hgphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('hgphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('hgphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('hgphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('hgphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('hgphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;

%% For allphi
c_all = mod_pred.allphi(:,3);
c_all = c_all(:);
c0 = mod_pred.allphi(:,2) == 0;
c_0 = mod_pred.allphi(c0,3);
c_0 = c_0(:);
c1 = mod_pred.allphi(:,2) == 1;
c_1 = mod_pred.allphi(c1,3);
c_1 = c_1(:);
c2 = mod_pred.allphi(:,2) == 2;
c_2 = mod_pred.allphi(c2,3);
c_2 = c_2(:);
c_12 = [c_1;c_2];
% figure;
% mask = c_all > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_all(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_all(~mask),bin_edges,'FaceColor','red');
% title('allphi - All cells', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
% mask = c_0 > 0;
% bin_edges = -0.000005:0.0000005:0.00001;
% histogram(c_0(mask),bin_edges,'FaceColor','green');
% hold on;
% histogram(c_0(~mask),bin_edges,'FaceColor','red');
% title('allphi - type 0', 'fontsize',40);
% hold on;
% pc = 100 * sum(mask)/length(mask);
% text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
% hold off;
% figure;
mask = c_1 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_1(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_1(~mask),bin_edges,'FaceColor','red');
title('allphi - type 1', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_2 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_2(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_2(~mask),bin_edges,'FaceColor','red');
title('allphi - type 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;
figure;
mask = c_12 > 0;
bin_edges = -0.000005:0.0000005:0.00001;
histogram(c_12(mask),bin_edges,'FaceColor','green');
hold on;
histogram(c_12(~mask),bin_edges,'FaceColor','red');
title('allphi - type 1 and 2', 'fontsize',40);
hold on;
pc = 100 * sum(mask)/length(mask);
text(-0.000005,10,strcat('Percentage of improved models :',{' '}, num2str(round(pc,2))),'fontsize',12);
hold off;

% %% Box Plots
% C3 = mod_pred.dphi(:,3)';
% C0 = mod_pred.dphi(c0,3)';
% C1 = mod_pred.dphi(c1,3)';
% C2 = mod_pred.dphi(c2,3)';
% C = [C3 C0 C1 C2];
% grp = [repmat("All cells", 1, length(C3)),repmat("Type0", 1, length(C0)),repmat("Type1", 1, length(C1)),repmat("Type2", 1, length(C2))];
% figure
% boxplot(C,grp);
% title('dphi', 'Fontsize', 40)
% 
% C3 = mod_pred.tphi(:,3)';
% C0 = mod_pred.tphi(c0,3)';
% C1 = mod_pred.tphi(c1,3)';
% C2 = mod_pred.tphi(c2,3)';
% C = [C3 C0 C1 C2];
% grp = [repmat("All cells", 1, length(C3)),repmat("Type0", 1, length(C0)),repmat("Type1", 1, length(C1)),repmat("Type2", 1, length(C2))];
% figure
% boxplot(C,grp);
% title('tphi', 'Fontsize', 40)
% 
% C3 = mod_pred.bphi(:,3)';
% C0 = mod_pred.bphi(c0,3)';
% C1 = mod_pred.bphi(c1,3)';
% C2 = mod_pred.bphi(c2,3)';
% C = [C3 C0 C1 C2];
% grp = [repmat("All cells", 1, length(C3)),repmat("Type0", 1, length(C0)),repmat("Type1", 1, length(C1)),repmat("Type2", 1, length(C2))];
% figure
% boxplot(C,grp);
% title('bphi', 'Fontsize', 40)
% 
% C3 = mod_pred.lgphi(:,3)';
% C0 = mod_pred.lgphi(c0,3)';
% C1 = mod_pred.lgphi(c1,3)';
% C2 = mod_pred.lgphi(c2,3)';
% C = [C3 C0 C1 C2];
% grp = [repmat("All cells", 1, length(C3)),repmat("Type0", 1, length(C0)),repmat("Type1", 1, length(C1)),repmat("Type2", 1, length(C2))];
% figure
% boxplot(C,grp);
% title('lgphi', 'Fontsize', 40)
% 
% C3 = mod_pred.hgphi(:,3)';
% C0 = mod_pred.hgphi(c0,3)';
% C1 = mod_pred.hgphi(c1,3)';
% C2 = mod_pred.hgphi(c2,3)';
% C = [C3 C0 C1 C2];
% grp = [repmat("All cells", 1, length(C3)),repmat("Type0", 1, length(C0)),repmat("Type1", 1, length(C1)),repmat("Type2", 1, length(C2))];
% figure
% boxplot(C,grp);
% title('hgphi', 'Fontsize', 40)